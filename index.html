<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Management Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Contact Management Tool</h1>
    
    <div id="auth-section">
        <h2>Sign Up</h2>
        <form id="signup-form">
            <input type="email" id="signup-email" placeholder="Email" required>
            <input type="password" id="signup-password" placeholder="Password" required>
            <button type="submit">Sign Up</button>
        </form>

        <h2>Log In</h2>
        <form id="login-form">
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <button type="submit">Log In</button>
        </form>
    </div>

    <div id="contact-section">
        <h2>Manage Contacts</h2>
        <form id="contact-form">
            <input type="text" id="name" placeholder="Name">
            <input type="text" id="mobile-number" placeholder="Mobile Number">
            <input type="text" id="task" placeholder="Task">
            <input type="number" id="amount" placeholder="Amount">
            <input type="date" id="deadline" placeholder="Deadline">
            <input type="text" id="remark1" placeholder="Remark 1">
            <input type="text" id="remark2" placeholder="Remark 2">
            <input type="text" id="remark3" placeholder="Remark 3">
            <input type="text" id="village" placeholder="Village">
            <button type="submit" id="add-button">Add Contact</button>
        </form>

        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Mobile Number</th>
                    <th>Task</th>
                    <th>Amount</th>
                    <th>Deadline Date</th>
                    <th>Remark 1</th>
                    <th>Remark 2</th>
                    <th>Remark 3</th>
                    <th>Village</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="contacts-table-body"></tbody>
        </table>
    </div>

    <script type="module">
        const SUPABASE_URL = 'https://qnefthbdtiwgwjjxxeey.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFuZWZ0aGJkdGl3Z3dqanh4ZWV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkyNjg0NzUsImV4cCI6MjA0NDg0NDQ3NX0.uZS02X8G7GAkoGuvmYVmhEuQY9VrFwmqXwLRbdeboHQ';

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Function to sign up a new user
        async function signUp(event) {
            event.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;

            const { user, error } = await supabaseClient.auth.signUp({ email, password });
            if (error) {
                console.error('Error signing up:', error);
                alert('Error signing up: ' + error.message);
            } else {
                alert('Sign up successful! Please check your email for confirmation.');
                document.getElementById('signup-form').reset();
            }
        }

        // Function to log in an existing user
        async function logIn(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
            if (error) {
                console.error('Error logging in:', error);
                alert('Error logging in: ' + error.message);
            } else {
                alert('Login successful!');
                document.getElementById('login-form').reset();
                document.getElementById('contact-section').style.display = 'block';
                document.getElementById('auth-section').style.display = 'none';
                displayContacts(); // Load contacts after login
            }
        }

        // Function to add a new contact
        async function addContact(event) {
            event.preventDefault();
            const contact = {
                name: document.getElementById('name').value,
                mobile_number: document.getElementById('mobile-number').value,
                task: document.getElementById('task').value,
                amount: document.getElementById('amount').value,
                deadline_date: document.getElementById('deadline').value,
                remark1: document.getElementById('remark1').value,
                remark2: document.getElementById('remark2').value,
                remark3: document.getElementById('remark3').value,
                village: document.getElementById('village').value
            };

            const { data, error } = await supabaseClient.from('contacts').insert([contact]);
            if (error) {
                console.error('Error adding contact:', error);
                alert('Error adding contact: ' + error.message);
            } else {
                alert('Contact added successfully!');
                document.getElementById('contact-form').reset();
                displayContacts();
            }
        }

        // Function to fetch all contacts
        async function fetchContacts() {
            const { data, error } = await supabaseClient.from('contacts').select('*');
            if (error) {
                console.error('Error fetching contacts:', error);
                return [];
            }
            return data;
        }

        // Function to display contacts in the table
        async function displayContacts() {
            const contacts = await fetchContacts();
            const contactsTable = document.getElementById('contacts-table-body');
            contactsTable.innerHTML = ''; // Clear the table before displaying new data

            contacts.forEach(contact => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${contact.name || ''}</td>
                    <td>${contact.mobile_number || ''}</td>
                    <td>${contact.task || ''}</td>
                    <td>${contact.amount || ''}</td>
                    <td>${contact.deadline_date || ''}</td>
                    <td>${contact.remark1 || ''}</td>
                    <td>${contact.remark2 || ''}</td>
                    <td>${contact.remark3 || ''}</td>
                    <td>${contact.village || ''}</td>
                    <td>
                        <button onclick="editContact(${contact.id}, '${contact.name}', '${contact.mobile_number}', '${contact.task}', '${contact.amount}', '${contact.deadline_date}', '${contact.remark1}', '${contact.remark2}', '${contact.remark3}', '${contact.village}')">Edit</button>
                        <button onclick="deleteContact(${contact.id})">Delete</button>
                    </td>
                `;
                contactsTable.appendChild(row);
            });
        }

        // Function to edit a contact
        async function editContact(id, name, mobileNumber, task, amount, deadline, remark1, remark2, remark3, village) {
            document.getElementById('name').value = name;
            document.getElementById('mobile-number').value = mobileNumber;
            document.getElementById('task').value = task;
            document.getElementById('amount').value = amount;
            document.getElementById('deadline').value = deadline;
            document.getElementById('remark1').value = remark1;
            document.getElementById('remark2').value = remark2;
            document.getElementById('remark3').value = remark3;
            document.getElementById('village').value = village;

            const addButton = document.getElementById('add-button');
            addButton.textContent = 'Update Contact';
            addButton.onclick = async function () {
                const updatedContact = {
                    name: document.getElementById('name').value,
                    mobile_number: document.getElementById('mobile-number').value,
                    task: document.getElementById('task').value,
                    amount: document.getElementById('amount').value,
                    deadline_date: document.getElementById('deadline').value,
                    remark1: document.getElementById('remark1').value,
                    remark2: document.getElementById('remark2').value,
                    remark3: document.getElementById('remark3').value,
                    village: document.getElementById('village').value
                };

                const { data, error } = await supabaseClient.from('contacts').update(updatedContact).eq('id', id);
                if (error) {
                    console.error('Error updating contact:', error);
                    alert('Error updating contact: ' + error.message);
                } else {
                    alert('Contact updated successfully!');
                    addButton.textContent = 'Add Contact';
                    addButton.onclick = addContact;
                    document.getElementById('contact-form').reset();
                    displayContacts();
                }
            };
        }

        // Function to delete a contact
        async function deleteContact(id) {
            const { data, error } = await supabaseClient.from('contacts').delete().eq('id', id);
            if (error) {
                console.error('Error deleting contact:', error);
                alert('Error deleting contact: ' + error.message);
            } else {
                alert('Contact deleted successfully!');
                displayContacts();
            }
        }

        // Event listener for form submissions
        window.onload = async () => {
            document.getElementById('signup-form').addEventListener('submit', signUp);
            document.getElementById('login-form').addEventListener('submit', logIn);
            document.getElementById('contact-form').addEventListener('submit', addContact);
            document.getElementById('contact-section').style.display = 'none'; // Hide contact section initially
        };
    </script>
</body>
</html>
